{"content":"<h2 id=\"如何使用\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#如何使用\"><span>如何使用</span></a></h2>\n<ol>\n<li>使用docker部署juno<div class=\"language-shell line-numbers-mode\" data-ext=\"shell\" data-title=\"shell\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_USER=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_USER</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_PASSWORD=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_PASSWORD</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_ADDR=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_ADDR</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">PORT</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_DB=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">  -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 50001:50001</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yeelabs/juno</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div></li>\n<li>在conf.toml中将juno地址填写到GrpcAddr参数内(默认127.0.0.1:50001)</li>\n<li>进行调试</li>\n</ol>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">Tips</p>\n<p>juno与Yearning 共用同一个数据库。Yearning项目内的config.toml文件中RpcAddr配置项填写为juno所在主机的ip(请勿使用本地回环地址连接)及端口</p>\n<p>当前juno支持amd64/arm64。</p>\n</div>\n<h3 id=\"调用方法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#调用方法\"><span>调用方法</span></a></h3>\n<p>juno 采用原生net/rpc 库进行通信，主要提供以下方法</p>\n<ol>\n<li>Check （SQL语句检测）</li>\n<li>MergeAlterTables （多条DDL语句合并）</li>\n<li>Exec （SQL语句执行）</li>\n<li>Query （SQL查询）</li>\n</ol>\n<p>RPC初始化代码</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/lib/rpc.go</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">func</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> NewRpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">rpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tclient</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :=</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">DialHTTP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">C</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">General</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">RpcAddr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\tif</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> !=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> nil</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\tlog</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Println</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> client</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL检测调用 </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/fetch/fetch.go 204</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Check</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">CheckArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">      u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">SQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSchema</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">   u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Database</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">       s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">IP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tUsername</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPassword</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> lib</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Decrypt</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tKind</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Kind</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tLang</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">     \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">zh-cn</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tRule</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloRole</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL执行调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/order/audit/impl.go 70</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> isCall</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> bool</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Exec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">ExecArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tOrder</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">order</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tRules</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloRole</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">       source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">IP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tUsername</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPassword</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> lib</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Decrypt</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">isCall</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL查询调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/personal/impl.go 65</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Query</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">QueryArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">              q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Sql</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tLimit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">            model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloOther</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Limit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tInsulateWordList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> insulateWordList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>","env":{"base":"/","filePath":"/Users/henryyee/PersonalProjects/yearning_guide/docs/notes/development/juno.md","filePathRelative":"notes/development/juno.md","frontmatter":{"title":"Juno 调用","createTime":"2024/11/04 17:08:00","permalink":"/development/16e5vp2y/"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"如何使用\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#如何使用\"><span>如何使用</span></a></h2>\n<ol>\n<li>使用docker部署juno<div class=\"language-shell line-numbers-mode\" data-ext=\"shell\" data-title=\"shell\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_USER=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_USER</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_PASSWORD=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_PASSWORD</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_ADDR=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_ADDR</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">PORT</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_DB=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">  -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 50001:50001</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yeelabs/juno</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div></li>\n<li>在conf.toml中将juno地址填写到GrpcAddr参数内(默认127.0.0.1:50001)</li>\n<li>进行调试</li>\n</ol>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">Tips</p>\n<p>juno与Yearning 共用同一个数据库。Yearning项目内的config.toml文件中RpcAddr配置项填写为juno所在主机的ip(请勿使用本地回环地址连接)及端口</p>\n<p>当前juno支持amd64/arm64。</p>\n</div>\n<h3 id=\"调用方法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#调用方法\"><span>调用方法</span></a></h3>\n<p>juno 采用原生net/rpc 库进行通信，主要提供以下方法</p>\n<ol>\n<li>Check （SQL语句检测）</li>\n<li>MergeAlterTables （多条DDL语句合并）</li>\n<li>Exec （SQL语句执行）</li>\n<li>Query （SQL查询）</li>\n</ol>\n<p>RPC初始化代码</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/lib/rpc.go</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">func</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> NewRpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">rpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tclient</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :=</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">DialHTTP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">C</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">General</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">RpcAddr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\tif</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> !=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> nil</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\tlog</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Println</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> client</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL检测调用 </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/fetch/fetch.go 204</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Check</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">CheckArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">      u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">SQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSchema</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">   u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Database</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">       s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">IP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tUsername</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPassword</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> lib</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Decrypt</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tKind</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Kind</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tLang</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">     \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">zh-cn</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tRule</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloRole</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL执行调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/order/audit/impl.go 70</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> isCall</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> bool</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Exec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">ExecArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tOrder</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">order</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tRules</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloRole</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">       source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">IP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tUsername</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPassword</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> lib</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Decrypt</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">isCall</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL查询调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/personal/impl.go 65</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Query</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">QueryArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">              q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Sql</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tLimit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">            model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloOther</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Limit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tInsulateWordList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> insulateWordList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></template>","contentStripped":"<h2 id=\"如何使用\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#如何使用\"><span>如何使用</span></a></h2>\n<ol>\n<li>使用docker部署juno<div class=\"language-shell line-numbers-mode\" data-ext=\"shell\" data-title=\"shell\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_USER=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_USER</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_PASSWORD=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_PASSWORD</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_ADDR=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB_ADDR</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">PORT</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MYSQL_DB=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">YEARNING_DB</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">  -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 50001:50001</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yeelabs/juno</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div></li>\n<li>在conf.toml中将juno地址填写到GrpcAddr参数内(默认127.0.0.1:50001)</li>\n<li>进行调试</li>\n</ol>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">Tips</p>\n<p>juno与Yearning 共用同一个数据库。Yearning项目内的config.toml文件中RpcAddr配置项填写为juno所在主机的ip(请勿使用本地回环地址连接)及端口</p>\n<p>当前juno支持amd64/arm64。</p>\n</div>\n<h3 id=\"调用方法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#调用方法\"><span>调用方法</span></a></h3>\n<p>juno 采用原生net/rpc 库进行通信，主要提供以下方法</p>\n<ol>\n<li>Check （SQL语句检测）</li>\n<li>MergeAlterTables （多条DDL语句合并）</li>\n<li>Exec （SQL语句执行）</li>\n<li>Query （SQL查询）</li>\n</ol>\n<p>RPC初始化代码</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/lib/rpc.go</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">func</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> NewRpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">rpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tclient</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :=</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rpc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">DialHTTP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">C</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">General</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">RpcAddr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\tif</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> !=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> nil</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\tlog</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Println</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> client</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL检测调用 </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/fetch/fetch.go 204</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Check</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">CheckArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">      u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">SQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSchema</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">   u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Database</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">       s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">IP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tUsername</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPassword</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> lib</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Decrypt</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tKind</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     u</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Kind</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tLang</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">     \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">zh-cn</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tRule</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloRole</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL执行调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/order/audit/impl.go 70</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> isCall</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> bool</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Exec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">ExecArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tOrder</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">order</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tRules</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloRole</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">       source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">IP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">     source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tUsername</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tPassword</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> lib</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Decrypt</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">source</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">  model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">isCall</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\" data-title=\"go\"><button class=\"copy\" title=\"Copy code\" data-copied=\"Copied\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// SQL查询调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// Yearning/src/handler/personal/impl.go 65</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">var</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">engine</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Record</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">client</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Call</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Engine.Query</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">QueryArgs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tSQL</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">              q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Ref</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Sql</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tLimit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">            model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">GloOther</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Limit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\t\t\tInsulateWordList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> insulateWordList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t},</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">rs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"## 如何使用\n1. 使用docker部署juno\n   ```shell \n   docker run -d -e MYSQL_USER=${YEARNING_DB_USER} -e MYSQL_PASSWORD=${YEARNING_DB_PASSWORD} -e MYSQL_ADDR=${YEARNING_DB_ADDR:PORT} -e MYSQL_DB=${YEARNING_DB}  -p 50001:50001 yeelabs/juno\n   ```\n2. 在conf.toml中将juno地址填写到GrpcAddr参数内(默认127.0.0.1:50001)\n3. 进行调试\n\n::: tip\njuno与Yearning 共用同一个数据库。Yearning项目内的config.toml文件中RpcAddr配置项填写为juno所在主机的ip(请勿使用本地回环地址连接)及端口\n\n当前juno支持amd64/arm64。\n:::\n\n### 调用方法\n\njuno 采用原生net/rpc 库进行通信，主要提供以下方法\n\n1. Check （SQL语句检测）\n2. MergeAlterTables （多条DDL语句合并）\n3. Exec （SQL语句执行）\n4. Query （SQL查询）\n\nRPC初始化代码\n\n```go\n// Yearning/src/lib/rpc.go\nfunc NewRpc() *rpc.Client {\n\tclient, err := rpc.DialHTTP(\"tcp\", model.C.General.RpcAddr)\n\tif err != nil {\n\t\tlog.Println(err)\n\t}\n\treturn client\n}\n```\n\n```go\n// SQL检测调用 \n// Yearning/src/handler/fetch/fetch.go 204\nvar rs []engine.Record\nclient.Call(\"Engine.Check\", engine.CheckArgs{\n\t\t\tSQL:      u.SQL,\n\t\t\tSchema:   u.Database,\n\t\t\tIP:       s.IP,\n\t\t\tUsername: s.Username,\n\t\t\tPort:     s.Port,\n\t\t\tPassword: lib.Decrypt(s.Password),\n\t\t\tKind:     u.Kind,\n\t\t\tLang:     \"zh-cn\",\n\t\t\tRule:     model.GloRole,\n\t\t}, &rs)\n```\n```go\n// SQL执行调用\n// Yearning/src/handler/order/audit/impl.go 70\nvar isCall bool\nclient.Call(\"Engine.Exec\", &ExecArgs{\n\t\t\tOrder:    &order,\n\t\t\tRules:    model.GloRole,\n\t\t\tIP:       source.IP,\n\t\t\tPort:     source.Port,\n\t\t\tUsername: source.Username,\n\t\t\tPassword: lib.Decrypt(source.Password),\n\t\t\tMessage:  model.GloMessage,\n\t\t}, &isCall\n```\n```go\n// SQL查询调用\n// Yearning/src/handler/personal/impl.go 65\nvar rs []engine.Record\nclient.Call(\"Engine.Query\", &QueryArgs{\n\t\t\tSQL:              q.Ref.Sql,\n\t\t\tLimit:            model.GloOther.Limit,\n\t\t\tInsulateWordList: insulateWordList,\n\t\t}, &rs)\n```","excerpt":"","tasklists":0,"title":"","headers":[{"level":2,"title":"如何使用","slug":"如何使用","link":"#如何使用","children":[{"level":3,"title":"调用方法","slug":"调用方法","link":"#调用方法","children":[]}]}]}}
